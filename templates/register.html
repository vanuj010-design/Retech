<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ReTech | Create Account</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">
    <div class="card shadow p-4 mx-auto" style="max-width: 500px;">
        <h3 class="text-center mb-3">Create ReTech Account</h3>

        <input class="form-control mb-2" id="name" placeholder="Full Name">
        <input class="form-control mb-2" id="phone" placeholder="Phone Number">

        <select class="form-control mb-2" id="gender">
            <option value="">Select Gender</option>
            <option>Male</option>
            <option>Female</option>
            <option>Other</option>
        </select>

        <input class="form-control mb-2" id="age" type="number" placeholder="Age">
        <input class="form-control mb-2" id="email" type="email" placeholder="Gmail Address">
        <input class="form-control mb-2" id="password" type="password" placeholder="New Password">
        <input class="form-control mb-3" id="confirm_password" type="password" placeholder="Confirm Password">

        <button class="btn btn-success w-100" id="signupBtn" onclick="signup()">Create Account</button>
        <div id="msg" class="text-center mt-3 text-danger"></div>
    </div>
</div>

<script>
function signup() {
    const data = {
        name: document.getElementById("name").value.trim(),
        phone: document.getElementById("phone").value.trim(),
        gender: document.getElementById("gender").value,
        age: document.getElementById("age").value,
        email: document.getElementById("email").value.trim(),
        password: document.getElementById("password").value,
        confirm_password: document.getElementById("confirm_password").value
    };

    // Basic frontend validation
    if (!data.name || !data.phone || !data.gender || !data.age ||
        !data.email || !data.password || !data.confirm_password) {
        document.getElementById("msg").innerText = "All fields are required";
        return;
    }

    const btn = document.getElementById("signupBtn");
    btn.disabled = true;
    btn.innerText = "Sending OTP...";

    fetch("/signup", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
    })
    .then(async res => {
    const text = await res.text();
    try {
        return JSON.parse(text);
    } catch (e) {
        console.error("Server response (not JSON):", text);
        throw new Error("Server error");
    }
})

    .then(res => {
        if (res.success) {
            // IMPORTANT: correct key name
            localStorage.setItem("otp_email", data.email);
            window.location.href = "/verify";
        } else {
            document.getElementById("msg").innerText = res.message;
            btn.disabled = false;
            btn.innerText = "Create Account";
        }
    })
    .catch(err => {
        document.getElementById("msg").innerText = "Something went wrong ‚ùå";
        btn.disabled = false;
        btn.innerText = "Create Account";
        console.error(err);
    });
}
</script>

</body>
</html>
