<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Order #{{ order.id }} | Admin</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body { background:#f4f6f9; }
        .card { border:none; border-radius:10px; }
        .section-title { font-weight:600; margin-bottom:10px; }
        table th, table td { vertical-align: middle; }
    </style>
</head>
<body>

<div class="container mt-4">

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4>Order #{{ order.id }}</h4>
        <a href="/admin/orders/pending" class="btn btn-outline-secondary btn-sm">
            ← Back
        </a>
    </div>

    <!-- ORDER + CUSTOMER INFO -->
    <div class="row mb-4">

        <!-- ORDER INFO -->
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="section-title">Order Information</div>

                    <p><strong>Status:</strong>
                        <span class="badge 
                            {% if order.status == 'Completed' %}
                                bg-success
                            {% elif order.status == 'Cancelled' %}
                                bg-danger
                            {% else %}
                                bg-warning text-dark
                            {% endif %}
                        ">
                            {{ order.status }}
                        </span>
                    </p>

                    <p><strong>Total Amount:</strong> ₹{{ order.total_amount }}</p>
                    <p><strong>Order Date:</strong>
                        {{ order.created_at.strftime("%d %b %Y, %I:%M %p") }}
                    </p>

                    <!-- UPDATE STATUS -->
                    <form method="post" class="mt-3">
                        <label class="form-label">Update Order Status</label>
                        <select name="status" class="form-select mb-2">
                            <option value="Placed" {% if order.status=='Placed' %}selected{% endif %}>Placed</option>
                            <option value="Shipped" {% if order.status=='Shipped' %}selected{% endif %}>Shipped</option>
                            <option value="Completed" {% if order.status=='Completed' %}selected{% endif %}>Completed</option>
                            <option value="Cancelled" {% if order.status=='Cancelled' %}selected{% endif %}>Cancelled</option>
                        </select>
                        <button class="btn btn-primary btn-sm">Update Status</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- CUSTOMER & ADDRESS -->
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="section-title">Customer & Address</div>

                    <p><strong>Name:</strong> {{ order.name }}</p>
                    <p><strong>Email:</strong> {{ order.email }}</p>

                    <hr>

                    <p><strong>Delivery Address</strong></p>
                    <p class="mb-0">
                        {{ address.full_name }}<br>
                        {{ address.phone }}<br>
                        {{ address.address_line }}<br>
                        {{ address.city }}, {{ address.state }} - {{ address.pincode }}
                    </p>
                </div>
            </div>
        </div>

    </div>

    <!-- ORDER ITEMS -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <div class="section-title">Ordered Items</div>

            <table class="table table-bordered table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>Product</th>
                        <th class="text-center">Qty</th>
                        <th>Price</th>
                        <th>Subtotal</th>
                    </tr>
                </thead>
                <tbody>
                {% for i in items %}
                    <tr>
                        <td>{{ i.product_name }}</td>
                        <td class="text-center">{{ i.quantity }}</td>
                        <td>₹{{ i.price }}</td>
                        <td>₹{{ i.quantity * i.price }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- ORDER STATUS HISTORY -->
    <div class="card shadow-sm">
        <div class="card-body">
            <div class="section-title">Order Status History</div>

            {% if history %}
                <ul class="list-group">
                {% for h in history %}
                    <li class="list-group-item d-flex justify-content-between">
                        <span>{{ h.status }}</span>
                        <span class="text-muted">
                            {{ h.changed_at.strftime("%d %b %Y, %I:%M %p") }}
                        </span>
                    </li>
                {% endfor %}
                </ul>
            {% else %}
                <p class="text-muted">No status history available.</p>
            {% endif %}
        </div>
    </div>

</div>

</body>
</html>
